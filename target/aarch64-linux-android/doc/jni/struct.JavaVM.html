<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="The Java VM, providing Invocation API support."><title>JavaVM in jni - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../static.files/rustdoc-b7b9f40b.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="jni" data-themes="" data-resource-suffix="" data-rustdoc-version="1.95.0-nightly (7f99507f5 2026-02-19)" data-channel="nightly" data-search-js="search-63369b7b.js" data-stringdex-js="stringdex-b897f86f.js" data-settings-js="settings-170eb4bf.js" ><script src="../static.files/storage-41dd4d93.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-5013f961.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-f7c3ffd8.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-044be391.svg"></head><body class="rustdoc struct"><a class="skip-main-content" href="#main-content">Skip to main content</a><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">JavaVM</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../jni/index.html">jni</a><span class="version">0.21.1</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">JavaVM</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#attaching-native-threads" title="Attaching Native Threads">Attaching Native Threads</a><ul><li><a href="#local-reference-management" title="Local Reference Management">Local Reference Management</a></li><li><a href="#executor" title="Executor">Executor</a></li></ul></li><li><a href="#launching-jvm-from-rust" title="Launching JVM from Rust">Launching JVM from Rust</a></li></ul><h3><a href="#implementations">Methods</a></h3><ul class="block method"><li><a href="#method.attach_current_thread" title="attach_current_thread">attach_current_thread</a></li><li><a href="#method.attach_current_thread_as_daemon" title="attach_current_thread_as_daemon">attach_current_thread_as_daemon</a></li><li><a href="#method.attach_current_thread_permanently" title="attach_current_thread_permanently">attach_current_thread_permanently</a></li><li><a href="#method.destroy" title="destroy">destroy</a></li><li><a href="#method.detach_current_thread" title="detach_current_thread">detach_current_thread</a></li><li><a href="#method.from_raw" title="from_raw">from_raw</a></li><li><a href="#method.get_env" title="get_env">get_env</a></li><li><a href="#method.get_java_vm_pointer" title="get_java_vm_pointer">get_java_vm_pointer</a></li><li><a href="#method.threads_attached" title="threads_attached">threads_attached</a></li></ul><h3><a href="#trait-implementations">Trait Implementations</a></h3><ul class="block trait-implementation"><li><a href="#impl-Debug-for-JavaVM" title="Debug">Debug</a></li><li><a href="#impl-Send-for-JavaVM" title="Send">Send</a></li><li><a href="#impl-Sync-for-JavaVM" title="Sync">Sync</a></li></ul><h3><a href="#synthetic-implementations">Auto Trait Implementations</a></h3><ul class="block synthetic-implementation"><li><a href="#impl-Freeze-for-JavaVM" title="Freeze">Freeze</a></li><li><a href="#impl-RefUnwindSafe-for-JavaVM" title="RefUnwindSafe">RefUnwindSafe</a></li><li><a href="#impl-Unpin-for-JavaVM" title="Unpin">Unpin</a></li><li><a href="#impl-UnsafeUnpin-for-JavaVM" title="UnsafeUnpin">UnsafeUnpin</a></li><li><a href="#impl-UnwindSafe-for-JavaVM" title="UnwindSafe">UnwindSafe</a></li></ul><h3><a href="#blanket-implementations">Blanket Implementations</a></h3><ul class="block blanket-implementation"><li><a href="#impl-Any-for-T" title="Any">Any</a></li><li><a href="#impl-Borrow%3CT%3E-for-T" title="Borrow&#60;T&#62;">Borrow&#60;T&#62;</a></li><li><a href="#impl-BorrowMut%3CT%3E-for-T" title="BorrowMut&#60;T&#62;">BorrowMut&#60;T&#62;</a></li><li><a href="#impl-From%3CT%3E-for-T" title="From&#60;T&#62;">From&#60;T&#62;</a></li><li><a href="#impl-Into%3CU%3E-for-T" title="Into&#60;U&#62;">Into&#60;U&#62;</a></li><li><a href="#impl-TryFrom%3CU%3E-for-T" title="TryFrom&#60;U&#62;">TryFrom&#60;U&#62;</a></li><li><a href="#impl-TryInto%3CU%3E-for-T" title="TryInto&#60;U&#62;">TryInto&#60;U&#62;</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="index.html">In crate jni</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content" tabindex="-1"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="index.html">jni</a></div><h1>Struct <span class="struct">JavaVM</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/jni/wrapper/java_vm/vm.rs.html#139">Source</a> </span></div><pre class="rust item-decl"><code>pub struct JavaVM(<span class="comment">/* private fields */</span>);</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>The Java VM, providing <a href="https://docs.oracle.com/en/java/javase/12/docs/specs/jni/invocation.html">Invocation API</a> support.</p>
<p>The JavaVM can be obtained either via <a href="struct.JNIEnv.html#method.get_java_vm"><code>JNIEnv#get_java_vm</code></a> in an already attached
thread, or it can be <a href="#launching-jvm-from-rust">launched</a> from Rust via <code>JavaVM#new</code>.</p>
<h3 id="attaching-native-threads"><a class="doc-anchor" href="#attaching-native-threads">§</a>Attaching Native Threads</h3>
<p>A native thread must «attach» itself to be able to call Java methods outside of a native Java
method. This library provides two modes of attachment, each ensuring the thread is promptly
detached:</p>
<ul>
<li>A scoped attachment with <a href="struct.JavaVM.html#method.attach_current_thread"><code>attach_current_thread</code></a>.
The thread will automatically detach itself once the returned guard is dropped.</li>
<li>A permanent attachment with <a href="struct.JavaVM.html#method.attach_current_thread_permanently"><code>attach_current_thread_permanently</code></a>
or <a href="struct.JavaVM.html#method.attach_current_thread_as_daemon"><code>attach_current_thread_as_daemon</code></a>.
The thread will automatically detach itself before it terminates.</li>
</ul>
<p>As attachment and detachment of a thread is an expensive operation, the scoped attachment
shall be used if happens infrequently. If you have an undefined scope where you need
to use <code>JNIEnv</code> and cannot keep the <code>AttachGuard</code>, consider attaching the thread
permanently.</p>
<h4 id="local-reference-management"><a class="doc-anchor" href="#local-reference-management">§</a>Local Reference Management</h4>
<p>Remember that the native thread attached to the VM <strong>must</strong> manage the local references
properly, i.e., do not allocate an excessive number of references and release them promptly
when they are no longer needed to enable the GC to collect them. A common approach is to use
an appropriately-sized local frame for larger code fragments
(see <a href="struct.JNIEnv.html#method.with_local_frame"><code>with_local_frame</code></a> and <a href="#executor">Executor</a>)
and <a href="struct.JNIEnv.html#method.auto_local">auto locals</a> in loops.</p>
<p>See also the <a href="https://docs.oracle.com/en/java/javase/12/docs/specs/jni/design.html#referencing-java-objects">JNI specification</a> for details on referencing Java objects.</p>
<h4 id="executor"><a class="doc-anchor" href="#executor">§</a>Executor</h4>
<p>Jni-rs provides an <a href="struct.Executor.html"><code>Executor</code></a> — a helper struct that allows to
execute a closure with <code>JNIEnv</code>. It combines the performance benefits of permanent attaches
<em>and</em> automatic local reference management. Prefer it to manual permanent attaches if
they happen in various parts of the code to reduce the burden of local reference management.</p>
<h3 id="launching-jvm-from-rust"><a class="doc-anchor" href="#launching-jvm-from-rust">§</a>Launching JVM from Rust</h3>
<p>To <a href="struct.JavaVM.html#method.new">launch</a> a JVM from a native process, enable the <code>invocation</code>
feature in the Cargo.toml:</p>
<div class="example-wrap"><pre class="language-toml"><code>jni = { version = &quot;0.21.1&quot;, features = [&quot;invocation&quot;] }</code></pre></div>
<p>The application will be able to use [<code>JavaVM::new</code>] which will dynamically
load a <code>jvm</code> library (which is distributed with the JVM) at runtime:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Build the VM properties
</span><span class="kw">let </span>jvm_args = InitArgsBuilder::new()
          <span class="comment">// Pass the JNI API version (default is 8)
          </span>.version(JNIVersion::V8)
          <span class="comment">// You can additionally pass any JVM options (standard, like a system property,
          // or VM-specific).
          // Here we enable some extra JNI checks useful during development
          </span>.option(<span class="string">"-Xcheck:jni"</span>)
          .build()
          .unwrap();

<span class="comment">// Create a new VM
</span><span class="kw">let </span>jvm = JavaVM::new(jvm_args)<span class="question-mark">?</span>;

<span class="comment">// Attach the current thread to call into Java — see extra options in
// "Attaching Native Threads" section.
//
// This method returns the guard that will detach the current thread when dropped,
// also freeing any local references created in it
</span><span class="kw">let </span><span class="kw-2">mut </span>env = jvm.attach_current_thread()<span class="question-mark">?</span>;

<span class="comment">// Call Java Math#abs(-10)
</span><span class="kw">let </span>x = JValue::from(-<span class="number">10</span>);
<span class="kw">let </span>val: jint = env.call_static_method(<span class="string">"java/lang/Math"</span>, <span class="string">"abs"</span>, <span class="string">"(I)I"</span>, <span class="kw-2">&amp;</span>[x])<span class="question-mark">?
  </span>.i()<span class="question-mark">?</span>;

<span class="macro">assert_eq!</span>(val, <span class="number">10</span>);
</code></pre></div>
<p>At runtime, the JVM installation path is determined via the <a href="https://crates.io/crates/java-locator">java-locator</a> crate:</p>
<ol>
<li>By the <code>JAVA_HOME</code> environment variable, if it is set.</li>
<li>Otherwise — from <code>java</code> output.</li>
</ol>
<p>It is recommended to set <code>JAVA_HOME</code></p>
<p>For the operating system to correctly load the <code>jvm</code> library it may also be
necessary to update the path that the OS uses to find dependencies of the
<code>jvm</code> library.</p>
<ul>
<li>On <strong>Windows</strong>, append the path to <code>$JAVA_HOME/bin</code> to the <code>PATH</code> environment variable.</li>
<li>On <strong>MacOS</strong>, append the path to <code>libjvm.dylib</code> to <code>LD_LIBRARY_PATH</code> environment variable.</li>
<li>On <strong>Linux</strong>, append the path to <code>libjvm.so</code> to <code>LD_LIBRARY_PATH</code> environment variable.</li>
</ul>
<p>The exact relative path to <code>jvm</code> library is version-specific.</p>
</div></details><h2 id="implementations" class="section-header">Implementations<a href="#implementations" class="anchor">§</a></h2><div id="implementations-list"><details class="toggle implementors-toggle" open><summary><section id="impl-JavaVM" class="impl"><a class="src rightside" href="../src/jni/wrapper/java_vm/vm.rs.html#144-459">Source</a><a href="#impl-JavaVM" class="anchor">§</a><h3 class="code-header">impl <a class="struct" href="struct.JavaVM.html" title="struct jni::JavaVM">JavaVM</a></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.from_raw" class="method"><a class="src rightside" href="../src/jni/wrapper/java_vm/vm.rs.html#239-242">Source</a><h4 class="code-header">pub unsafe fn <a href="#method.from_raw" class="fn">from_raw</a>(ptr: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*mut </a><a class="type" href="sys/type.JavaVM.html" title="type jni::sys::JavaVM">JavaVM</a>) -&gt; <a class="type" href="errors/type.Result.html" title="type jni::errors::Result">Result</a>&lt;Self&gt;</h4></section></summary><div class="docblock"><p>Create a JavaVM from a raw pointer.</p>
<h5 id="safety"><a class="doc-anchor" href="#safety">§</a>Safety</h5>
<p>Expects a valid pointer retrieved from the <code>JNI_CreateJavaVM</code> JNI function. Only does null check.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.get_java_vm_pointer" class="method"><a class="src rightside" href="../src/jni/wrapper/java_vm/vm.rs.html#245-247">Source</a><h4 class="code-header">pub fn <a href="#method.get_java_vm_pointer" class="fn">get_java_vm_pointer</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*mut </a><a class="type" href="sys/type.JavaVM.html" title="type jni::sys::JavaVM">JavaVM</a></h4></section></summary><div class="docblock"><p>Returns underlying <code>sys::JavaVM</code> interface.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.attach_current_thread_permanently" class="method"><a class="src rightside" href="../src/jni/wrapper/java_vm/vm.rs.html#259-264">Source</a><h4 class="code-header">pub fn <a href="#method.attach_current_thread_permanently" class="fn">attach_current_thread_permanently</a>(&amp;self) -&gt; <a class="type" href="errors/type.Result.html" title="type jni::errors::Result">Result</a>&lt;<a class="struct" href="struct.JNIEnv.html" title="struct jni::JNIEnv">JNIEnv</a>&lt;'_&gt;&gt;</h4></section></summary><div class="docblock"><p>Attaches the current thread to the JVM. Calling this for a thread that is already attached
is a no-op.</p>
<p>The thread will detach itself automatically when it exits.</p>
<p>Attached threads <a href="https://docs.oracle.com/en/java/javase/12/docs/specs/jni/invocation.html#unloading-the-vm">block JVM exit</a>. If it is not desirable — consider using
<a href="struct.JavaVM.html#method.attach_current_thread_as_daemon"><code>attach_current_thread_as_daemon</code></a>.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.attach_current_thread" class="method"><a class="src rightside" href="../src/jni/wrapper/java_vm/vm.rs.html#279-287">Source</a><h4 class="code-header">pub fn <a href="#method.attach_current_thread" class="fn">attach_current_thread</a>(&amp;self) -&gt; <a class="type" href="errors/type.Result.html" title="type jni::errors::Result">Result</a>&lt;<a class="struct" href="struct.AttachGuard.html" title="struct jni::AttachGuard">AttachGuard</a>&lt;'_&gt;&gt;</h4></section></summary><div class="docblock"><p>Attaches the current thread to the Java VM. The returned <code>AttachGuard</code>
can be dereferenced to a <code>JNIEnv</code> and automatically detaches the thread
when dropped. Calling this in a thread that is already attached is a no-op, and
will neither change its daemon status nor prematurely detach it.</p>
<p>Attached threads <a href="https://docs.oracle.com/en/java/javase/12/docs/specs/jni/invocation.html#unloading-the-vm">block JVM exit</a>.</p>
<p>Attaching and detaching a thread is an expensive operation. If you use it frequently
in the same threads, consider either <a href="struct.JavaVM.html#method.attach_current_thread_as_daemon">attaching them permanently</a>,
or, if the scope where you need the <code>JNIEnv</code> is well-defined, keeping the returned guard.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.detach_current_thread" class="method"><a class="src rightside" href="../src/jni/wrapper/java_vm/vm.rs.html#324-326">Source</a><h4 class="code-header">pub unsafe fn <a href="#method.detach_current_thread" class="fn">detach_current_thread</a>(&amp;self)</h4></section></summary><div class="docblock"><p>Explicitly detaches the current thread from the JVM.</p>
<p><em><strong>Note</strong>: This operation is <em>rarely</em> appropriate to use, because the
attachment methods <a href="#attaching-native-threads">ensure</a> that the thread
is automatically detached.</em></p>
<p>Detaching a non-attached thread is a no-op.</p>
<p>To support the use of <code>JavaVM::destroy()</code> it may be necessary to use this API to
explicitly detach daemon threads before <code>JavaVM::destroy()</code> is called because
<code>JavaVM::destroy()</code> does not synchronize and wait for daemon threads.</p>
<p>Any daemon thread that is still “attached” after <code>JavaVM::destroy()</code> returns would
cause undefined behaviour if it then tries to make any JNI calls or tries
to detach itself.</p>
<p>Normally <code>jni-rs</code> will automatically detach threads from the <code>JavaVM</code> by storing
a guard in thread-local-storage that will detach on <code>Drop</code> but this will cause
undefined behaviour if <code>JavaVM::destroy()</code> has been called.</p>
<p>Calling this will clear the thread-local-storage guard and detach the thread
early to avoid any attempt to automatically detach when the thread exits.</p>
<h5 id="safety-1"><a class="doc-anchor" href="#safety-1">§</a>Safety</h5>
<p><strong>Any existing <code>JNIEnv</code>s and <code>AttachGuard</code>s created in the calling thread
will be invalidated after this method completes. It is the</strong> caller’s <strong>responsibility
to ensure that no JNI calls are subsequently performed on these objects.</strong>
Failure to do so will result in unspecified errors, possibly, the process crash.</p>
<p>Given some care is exercised, this method can be used to detach permanently attached
threads <em>before</em> they exit (when automatic detachment occurs). However, it is
never appropriate to use it with the scoped attachment (<code>attach_current_thread</code>).</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.attach_current_thread_as_daemon" class="method"><a class="src rightside" href="../src/jni/wrapper/java_vm/vm.rs.html#332-337">Source</a><h4 class="code-header">pub fn <a href="#method.attach_current_thread_as_daemon" class="fn">attach_current_thread_as_daemon</a>(&amp;self) -&gt; <a class="type" href="errors/type.Result.html" title="type jni::errors::Result">Result</a>&lt;<a class="struct" href="struct.JNIEnv.html" title="struct jni::JNIEnv">JNIEnv</a>&lt;'_&gt;&gt;</h4></section></summary><div class="docblock"><p>Attaches the current thread to the Java VM as a <em>daemon</em>. Calling this in a thread
that is already attached is a no-op, and will not change its status to a daemon thread.</p>
<p>The thread will detach itself automatically when it exits.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.threads_attached" class="method"><a class="src rightside" href="../src/jni/wrapper/java_vm/vm.rs.html#342-344">Source</a><h4 class="code-header">pub fn <a href="#method.threads_attached" class="fn">threads_attached</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a></h4></section></summary><div class="docblock"><p>Returns the current number of threads attached to the JVM.</p>
<p>This method is provided mostly for diagnostic purposes.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.get_env" class="method"><a class="src rightside" href="../src/jni/wrapper/java_vm/vm.rs.html#349-357">Source</a><h4 class="code-header">pub fn <a href="#method.get_env" class="fn">get_env</a>(&amp;self) -&gt; <a class="type" href="errors/type.Result.html" title="type jni::errors::Result">Result</a>&lt;<a class="struct" href="struct.JNIEnv.html" title="struct jni::JNIEnv">JNIEnv</a>&lt;'_&gt;&gt;</h4></section></summary><div class="docblock"><p>Get the <code>JNIEnv</code> associated with the current thread, or
<code>ErrorKind::Detached</code>
if the current thread is not attached to the java VM.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.destroy" class="method"><a class="src rightside" href="../src/jni/wrapper/java_vm/vm.rs.html#453-458">Source</a><h4 class="code-header">pub unsafe fn <a href="#method.destroy" class="fn">destroy</a>(&amp;self) -&gt; <a class="type" href="errors/type.Result.html" title="type jni::errors::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Unloads the JavaVM and frees all it’s associated resources</p>
<p>Firstly if this thread is not already attached to the <code>JavaVM</code> then
it will be attached.</p>
<p>This thread will then wait until there are no other non-daemon threads
attached to the <code>JavaVM</code> before unloading it (including threads spawned
by Java and those that are attached via JNI)</p>
<h5 id="safety-2"><a class="doc-anchor" href="#safety-2">§</a>Safety</h5>
<p>IF YOU ARE USING DAEMON THREADS THIS MAY BE DIFFICULT TO USE SAFELY!</p>
<h6 id="daemon-thread-rules"><a class="doc-anchor" href="#daemon-thread-rules">§</a>Daemon thread rules</h6>
<p>Since the JNI spec makes it clear that <code>DestroyJavaVM</code> will not wait for
attached deamon threads to exit, this also means that if you do have any
attached daemon threads it is your responsibility to ensure that they
don’t try and use JNI after the <code>JavaVM</code> is destroyed and you won’t be able
to detach them after the <code>JavaVM</code> has been destroyed.</p>
<p>This creates a very unsafe hazard in <code>jni-rs</code> because it normally automatically
ensures that any thread that gets attached will be detached before it exits.</p>
<p>Normally <code>jni-rs</code> will automatically detach threads from the <code>JavaVM</code> by storing
a guard in thread-local-storage that will detach on <code>Drop</code> but this will cause
undefined behaviour if <code>JavaVM::destroy()</code> has been called before the thread
exits.</p>
<p>To clear this thread-local-storage guard from daemon threads you can call
<a href="struct.JavaVM.html#method.detach_current_thread" title="method jni::JavaVM::detach_current_thread"><code>JavaVM::detach_current_thread()</code></a> within each daemon thread, before calling
this API.</p>
<p>Calling this will clear the thread-local-storage guard and detach the thread
early to avoid any attempt to automatically detach when the thread exits.</p>
<h6 id="dont-call-from-a-java-native-function"><a class="doc-anchor" href="#dont-call-from-a-java-native-function">§</a>Don’t call from a Java native function</h6>
<p>There must be no Java methods on the call stack when <code>JavaVM::destroy()</code> is called.</p>
<h6 id="drop-all-jni-state-including-auto-release-types-before-calling-javavmdestroy"><a class="doc-anchor" href="#drop-all-jni-state-including-auto-release-types-before-calling-javavmdestroy">§</a>Drop all JNI state, including auto-release types before calling <code>JavaVM::destroy()</code></h6>
<p>There is currently no <code>'vm</code> lifetime associated with a <code>JavaVM</code> that
would allow the borrow checker to enforce that all <code>jni</code> resources
associated with the <code>JavaVM</code> have been released.</p>
<p>Since these JNI resources could lead to undefined behaviour through any
use after the <code>JavaVM</code> has been destroyed then it is your responsibility
to release these resources.</p>
<p>In particular, there are numerous auto-release types in the <code>jni</code> API
that will automatically make JNI calls within their <code>Drop</code>
implementation. All such types <em>must</em> be dropped before <code>destroy()</code> is
called to avoid undefined bahaviour.</p>
<p>Here is an non-exhaustive list of auto-release types to consider:</p>
<ul>
<li><code>AttachGuard</code></li>
<li><code>AutoElements</code></li>
<li><code>AutoElementsCritical</code></li>
<li><code>AutoLocal</code></li>
<li><code>GlobalRef</code></li>
<li><code>JavaStr</code></li>
<li><code>JMap</code></li>
<li><code>WeakRef</code></li>
</ul>
<h6 id="invalid-javavm-on-return"><a class="doc-anchor" href="#invalid-javavm-on-return">§</a>Invalid <code>JavaVM</code> on return</h6>
<p>After <code>destroy()</code> returns then the <code>JavaVM</code> will be in an undefined state
and must be dropped (e.g. via <code>std::mem::drop()</code>) to avoid undefined behaviour.</p>
<p>This method doesn’t take ownership of the <code>JavaVM</code> before it is
destroyed because the <code>JavaVM</code> may have been shared (E.g. via an <code>Arc</code>)
between all the threads that have not yet necessarily exited before this
is called.</p>
<p>So although the <code>JavaVM</code> won’t necessarily be solely owned by this
thread when <code>destroy()</code> is first called it will conceptually own the
<code>JavaVM</code> before <code>destroy()</code> returns.</p>
</div></details></div></details></div><h2 id="trait-implementations" class="section-header">Trait Implementations<a href="#trait-implementations" class="anchor">§</a></h2><div id="trait-implementations-list"><details class="toggle implementors-toggle" open><summary><section id="impl-Debug-for-JavaVM" class="impl"><a class="src rightside" href="../src/jni/wrapper/java_vm/vm.rs.html#138">Source</a><a href="#impl-Debug-for-JavaVM" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/fmt/trait.Debug.html" title="trait core::fmt::Debug">Debug</a> for <a class="struct" href="struct.JavaVM.html" title="struct jni::JavaVM">JavaVM</a></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.fmt" class="method trait-impl"><a class="src rightside" href="../src/jni/wrapper/java_vm/vm.rs.html#138">Source</a><a href="#method.fmt" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/fmt/trait.Debug.html#tymethod.fmt" class="fn">fmt</a>(&amp;self, f: &amp;mut <a class="struct" href="https://doc.rust-lang.org/nightly/core/fmt/struct.Formatter.html" title="struct core::fmt::Formatter">Formatter</a>&lt;'_&gt;) -&gt; <a class="type" href="https://doc.rust-lang.org/nightly/core/fmt/type.Result.html" title="type core::fmt::Result">Result</a></h4></section></summary><div class='docblock'>Formats the value using the given formatter. <a href="https://doc.rust-lang.org/nightly/core/fmt/trait.Debug.html#tymethod.fmt">Read more</a></div></details></div></details><section id="impl-Send-for-JavaVM" class="impl"><a class="src rightside" href="../src/jni/wrapper/java_vm/vm.rs.html#141">Source</a><a href="#impl-Send-for-JavaVM" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> for <a class="struct" href="struct.JavaVM.html" title="struct jni::JavaVM">JavaVM</a></h3></section><section id="impl-Sync-for-JavaVM" class="impl"><a class="src rightside" href="../src/jni/wrapper/java_vm/vm.rs.html#142">Source</a><a href="#impl-Sync-for-JavaVM" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sync.html" title="trait core::marker::Sync">Sync</a> for <a class="struct" href="struct.JavaVM.html" title="struct jni::JavaVM">JavaVM</a></h3></section></div><h2 id="synthetic-implementations" class="section-header">Auto Trait Implementations<a href="#synthetic-implementations" class="anchor">§</a></h2><div id="synthetic-implementations-list"><section id="impl-Freeze-for-JavaVM" class="impl"><a href="#impl-Freeze-for-JavaVM" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Freeze.html" title="trait core::marker::Freeze">Freeze</a> for <a class="struct" href="struct.JavaVM.html" title="struct jni::JavaVM">JavaVM</a></h3></section><section id="impl-RefUnwindSafe-for-JavaVM" class="impl"><a href="#impl-RefUnwindSafe-for-JavaVM" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/panic/unwind_safe/trait.RefUnwindSafe.html" title="trait core::panic::unwind_safe::RefUnwindSafe">RefUnwindSafe</a> for <a class="struct" href="struct.JavaVM.html" title="struct jni::JavaVM">JavaVM</a></h3></section><section id="impl-Unpin-for-JavaVM" class="impl"><a href="#impl-Unpin-for-JavaVM" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Unpin.html" title="trait core::marker::Unpin">Unpin</a> for <a class="struct" href="struct.JavaVM.html" title="struct jni::JavaVM">JavaVM</a></h3></section><section id="impl-UnsafeUnpin-for-JavaVM" class="impl"><a href="#impl-UnsafeUnpin-for-JavaVM" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.UnsafeUnpin.html" title="trait core::marker::UnsafeUnpin">UnsafeUnpin</a> for <a class="struct" href="struct.JavaVM.html" title="struct jni::JavaVM">JavaVM</a></h3></section><section id="impl-UnwindSafe-for-JavaVM" class="impl"><a href="#impl-UnwindSafe-for-JavaVM" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/panic/unwind_safe/trait.UnwindSafe.html" title="trait core::panic::unwind_safe::UnwindSafe">UnwindSafe</a> for <a class="struct" href="struct.JavaVM.html" title="struct jni::JavaVM">JavaVM</a></h3></section></div><h2 id="blanket-implementations" class="section-header">Blanket Implementations<a href="#blanket-implementations" class="anchor">§</a></h2><div id="blanket-implementations-list"><details class="toggle implementors-toggle"><summary><section id="impl-Any-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/any.rs.html#138">Source</a><a href="#impl-Any-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/any/trait.Any.html" title="trait core::any::Any">Any</a> for T<div class="where">where
    T: 'static + ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,</div></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.type_id" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/any.rs.html#139">Source</a><a href="#method.type_id" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/any/trait.Any.html#tymethod.type_id" class="fn">type_id</a>(&amp;self) -&gt; <a class="struct" href="https://doc.rust-lang.org/nightly/core/any/struct.TypeId.html" title="struct core::any::TypeId">TypeId</a></h4></section></summary><div class='docblock'>Gets the <code>TypeId</code> of <code>self</code>. <a href="https://doc.rust-lang.org/nightly/core/any/trait.Any.html#tymethod.type_id">Read more</a></div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-Borrow%3CT%3E-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/borrow.rs.html#212">Source</a><a href="#impl-Borrow%3CT%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/borrow/trait.Borrow.html" title="trait core::borrow::Borrow">Borrow</a>&lt;T&gt; for T<div class="where">where
    T: ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,</div></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.borrow" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/borrow.rs.html#214">Source</a><a href="#method.borrow" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/borrow/trait.Borrow.html#tymethod.borrow" class="fn">borrow</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;T</a></h4></section></summary><div class='docblock'>Immutably borrows from an owned value. <a href="https://doc.rust-lang.org/nightly/core/borrow/trait.Borrow.html#tymethod.borrow">Read more</a></div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-BorrowMut%3CT%3E-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/borrow.rs.html#221">Source</a><a href="#impl-BorrowMut%3CT%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/borrow/trait.BorrowMut.html" title="trait core::borrow::BorrowMut">BorrowMut</a>&lt;T&gt; for T<div class="where">where
    T: ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,</div></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.borrow_mut" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/borrow.rs.html#222">Source</a><a href="#method.borrow_mut" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/borrow/trait.BorrowMut.html#tymethod.borrow_mut" class="fn">borrow_mut</a>(&amp;mut self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut T</a></h4></section></summary><div class='docblock'>Mutably borrows from an owned value. <a href="https://doc.rust-lang.org/nightly/core/borrow/trait.BorrowMut.html#tymethod.borrow_mut">Read more</a></div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-From%3CT%3E-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#785">Source</a><a href="#impl-From%3CT%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.From.html" title="trait core::convert::From">From</a>&lt;T&gt; for T</h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.from" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#788">Source</a><a href="#method.from" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/convert/trait.From.html#tymethod.from" class="fn">from</a>(t: T) -&gt; T</h4></section></summary><div class="docblock"><p>Returns the argument unchanged.</p>
</div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-Into%3CU%3E-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#767-769">Source</a><a href="#impl-Into%3CU%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T, U&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.Into.html" title="trait core::convert::Into">Into</a>&lt;U&gt; for T<div class="where">where
    U: <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.From.html" title="trait core::convert::From">From</a>&lt;T&gt;,</div></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.into" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#777">Source</a><a href="#method.into" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/convert/trait.Into.html#tymethod.into" class="fn">into</a>(self) -&gt; U</h4></section></summary><div class="docblock"><p>Calls <code>U::from(self)</code>.</p>
<p>That is, this conversion is whatever the implementation of
<code><a href="https://doc.rust-lang.org/nightly/core/convert/trait.From.html" title="trait core::convert::From">From</a>&lt;T&gt; for U</code> chooses to do.</p>
</div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-TryFrom%3CU%3E-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#827-829">Source</a><a href="#impl-TryFrom%3CU%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T, U&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom">TryFrom</a>&lt;U&gt; for T<div class="where">where
    U: <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.Into.html" title="trait core::convert::Into">Into</a>&lt;T&gt;,</div></h3></section></summary><div class="impl-items"><details class="toggle" open><summary><section id="associatedtype.Error-1" class="associatedtype trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#831">Source</a><a href="#associatedtype.Error-1" class="anchor">§</a><h4 class="code-header">type <a href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html#associatedtype.Error" class="associatedtype">Error</a> = <a class="enum" href="https://doc.rust-lang.org/nightly/core/convert/enum.Infallible.html" title="enum core::convert::Infallible">Infallible</a></h4></section></summary><div class='docblock'>The type returned in the event of a conversion error.</div></details><details class="toggle method-toggle" open><summary><section id="method.try_from" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#834">Source</a><a href="#method.try_from" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html#tymethod.try_from" class="fn">try_from</a>(value: U) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;T, &lt;T as <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom">TryFrom</a>&lt;U&gt;&gt;::<a class="associatedtype" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html#associatedtype.Error" title="type core::convert::TryFrom::Error">Error</a>&gt;</h4></section></summary><div class='docblock'>Performs the conversion.</div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-TryInto%3CU%3E-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#811-813">Source</a><a href="#impl-TryInto%3CU%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T, U&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryInto.html" title="trait core::convert::TryInto">TryInto</a>&lt;U&gt; for T<div class="where">where
    U: <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom">TryFrom</a>&lt;T&gt;,</div></h3></section></summary><div class="impl-items"><details class="toggle" open><summary><section id="associatedtype.Error" class="associatedtype trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#815">Source</a><a href="#associatedtype.Error" class="anchor">§</a><h4 class="code-header">type <a href="https://doc.rust-lang.org/nightly/core/convert/trait.TryInto.html#associatedtype.Error" class="associatedtype">Error</a> = &lt;U as <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom">TryFrom</a>&lt;T&gt;&gt;::<a class="associatedtype" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html#associatedtype.Error" title="type core::convert::TryFrom::Error">Error</a></h4></section></summary><div class='docblock'>The type returned in the event of a conversion error.</div></details><details class="toggle method-toggle" open><summary><section id="method.try_into" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#818">Source</a><a href="#method.try_into" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/convert/trait.TryInto.html#tymethod.try_into" class="fn">try_into</a>(self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;U, &lt;U as <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom">TryFrom</a>&lt;T&gt;&gt;::<a class="associatedtype" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html#associatedtype.Error" title="type core::convert::TryFrom::Error">Error</a>&gt;</h4></section></summary><div class='docblock'>Performs the conversion.</div></details></div></details></div></section></div></main></body></html>